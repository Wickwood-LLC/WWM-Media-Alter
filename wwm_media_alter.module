<?php

/**
 * Implements hook_media_wysiwyg_token_to_markup_alter().
 */
function wwm_media_alter_media_wysiwyg_token_to_markup_alter(&$element, $tag_info, $settings) {
  $file = $tag_info['file'];

  if (empty($file) || 'image' != $file->type) {
    return;
  }
  $wrapper = entity_metadata_wrapper('file', $file);
  if (!isset($wrapper->field_alignment)) {
    return;
  }

  // Add special alignment classes for image when entity is viewed.
  if (empty($settings['wysiwyg'])) {
    $file->tested = true;
    $style = $wrapper->field_alignment->value();
    if (!empty($style) && $style != '_none') {
      $element['content']['#attributes']['class'][] = $style;
    }
  }
}

/**
 * Implements hook_preprocess_HOOK()
 */
function wwm_media_alter_preprocess_file_entity(&$variables) {
  if ($variables['type'] == 'image' && isset($variables['file']->override['wysiwyg']) && $variables['file']->override['wysiwyg']) {
    $wrapper = entity_metadata_wrapper('file', $variables['file']);
    $style = $wrapper->field_alignment->value();
    if (!empty($style) && $style != '_none') {
      $variables['classes_array'][] = $style;
    }
  }
}
