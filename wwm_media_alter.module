<?php

/**
 * Implements hook_media_wysiwyg_token_to_markup_alter().
 */
function wwm_media_alter_media_wysiwyg_token_to_markup_alter(&$element, $tag_info, $settings) {
  $file = $tag_info['file'];

  if (!empty($settings['wysiwyg']) || empty($file) || 'image' != $file->type) {
    return;
  }
  // Add special alignment classes for image when entity is viewed.
  $wrapper = entity_metadata_wrapper('file', $file);
  $style = $wrapper->field_alignment->value();
  if (!empty($style) && $style != '_none') {
    $element['content']['#attributes']['class'] = array_merge($element['content']['#attributes']['class'], $tag_info['attributes']['class']);
  }
}

/**
 * Implements hook_preprocess_HOOK()
 */
function wwm_media_alter_preprocess_file_entity(&$variables) {
  if ($variables['type'] == 'image' && isset($variables['file']->override['wysiwyg']) && $variables['file']->override['wysiwyg']) {
    $wrapper = entity_metadata_wrapper('file', $variables['file']);
    $style = $wrapper->field_alignment->value();
    if (!empty($style) && $style != '_none') {
        $variables['classes_array'][] = $style;
    }
  }
}
