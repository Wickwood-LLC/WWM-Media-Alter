<?php
/**
 * Implements hook_media_wysiwyg_token_to_markup_alter().
 */
function wwm_media_alter_media_wysiwyg_token_to_markup_alter(&$element, $tag_info, $settings) {

  dpm('Starting Variables and Arrays for $element');
  dpm($element);
  dpm('Starting Variables and Arrays for $tag_info');
  dpm($tag_info);
  dpm('Starting Variables and Arrays for $settings');
  dpm($settings);
  
  $file = $tag_info['file'];
  if (!empty($settings['wysiwyg']) || empty($file) || 'image' != $file->type) {
    return;
  }
  $wrapper = entity_metadata_wrapper('file', $file);

  dpm('$wrapper values');
  dpm($wrapper);

  $styles = $wrapper->field_alignment->value();
 
  dpm('Starting Variables and Arrays for $styles');
  dpm($styles);

  if (!empty($styles)) {
    // foreach ($styles as $style) {
      $element['content']['#attributes']['class'][] = $styles;
    // }
  }

  dpm('Ending Variables and Arrays for $element');
  dpm($element);
  dpm('Ending Variables and Arrays for $styles');
  dpm($styles);
  
  // $link = $wrapper->field_myimagelinkfield->value();
  // if (!empty($link['url'])) {
  //   $url = url($link['url']);
  //   $element['content']['file']['#prefix'] = sprintf('<a href="%s">', $url);
  //   $element['content']['file']['#suffix'] = '</a>';
  // }
}
